<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<title>New Launch -10BUCK</title>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<meta name="format-detection" content="telephone=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<link type="text/css" href="css/style.css" rel="stylesheet">
</head>
<body>
	<div class="group_main" id="group_main">
    	<div class="group_top">
            <div class="group_head">
                <h1>Trial New</h1>
                <a href="javascript:void(0)" class="back"></a>
                <a href="javascript:void(0)" class="search"></a>
            </div>
        </div>
        <div id="wrapper" style="top:50px">
            <div id="scroller">
                <div id="pullDown">
                    <span class="pullDownIcon"></span><span class="pullDownLabel">Refresh...</span>
                </div>
              
              <div class="index_content" id="listcontent">
                	<div class="list_item">
                        <a href="javascript:void(0)"><img src="http://img0.bdstatic.com/img/image/shouye/mxlyf1211.jpg">
                        	<p><em>-25%</em></p>
                            <span>only 10 left</span>
                        </a>
                        <div><a href="javascript:void(0)" class="like"></a>$ 52<span>Rebate:<br>$ 1.5</span></div>
                    </div>
                    <div class="list_item">
                        <a href="javascript:void(0)"><img src="http://img0.bdstatic.com/img/image/shouye/mxlyf1211.jpg">
                        	<p><em>-25%</em></p>
                            <span>only 10 left</span>
                        </a>
                        <div><a href="javascript:void(0)" class="like"></a>$ 52<span>Rebate:<br>$ 1.5</span></div>
                    </div>
                    <div class="list_item">
                        <a href="javascript:void(0)"><img src="http://img0.bdstatic.com/img/image/shouye/mxlyf1211.jpg">
                        	<p><em>-25%</em></p>
                            <span>only 10 left</span>
                        </a>
                        <div><a href="javascript:void(0)" class="like"></a>$ 52<span>Rebate:<br>$ 1.5</span></div>
                    </div>
          
               </div>
                
                <div id="pullUp">
                    <span class="pullUpIcon"></span><span class="pullUpLabel">View More...</span>
                </div>
            </div>
        </div>
	</div>
    
    <input type="hidden" id="page" name="page" value="1" />
    <script type="text/javascript" src="js/jquery-1.10.1.min.js"></script>
    <script type="application/javascript" src="js/iscroll.newlaunch.js"></script>
    <script type="text/javascript"  src="js/jquery.imagesloaded.js"></script>
    <script type="application/javascript" src="js/jquery.wookmark.min.js"></script>
   <!--  <script type="text/javascript" src="js/10buckpull.js"></script> -->
	<script type="text/javascript" >
		// JavaScript Document
	var swidth=$(document).width()/2-2;
	$("#listcontent .list_item").width(swidth);
	var $tiles = $('#listcontent'),
		  $handler = $('.list_item', $tiles),
		  $main = $('#listcontent'),
		  $window = $(window),
		  $document = $(document),
		  options = {
			autoResize: true, // This will auto-update the layout when the browser window is resized.
			container: $main, // Optional, used for some extra CSS styling
			//offset: 20, // Optional, the distance between grid items
			itemWidth: swidth // Optional, the width of a grid item
		  };
	//var handler = $('#listcontent .list_item');
    //  handler.wookmark({
          // Prepare layout options.
     //     autoResize: true, // This will auto-update the layout when the browser window is resized.
      //    container: $('#listcontent'), // Optional, used for some extra CSS styling
         // offset: 5, // Optional, the distance between grid items
          //outerOffset: 10, // Optional, the distance to the containers border
        //  itemWidth: swidth // Optional, the width of a grid item
      //});
	  function applyLayout() {
        $tiles.imagesLoaded(function() {
          // Destroy the old handler
          if ($handler.wookmarkInstance) {
            $handler.wookmarkInstance.clear();
          }

          // Create a new layout handler.
          $handler = $('.list_item', $tiles);
          $handler.wookmark(options);
        });
      }
	  applyLayout();
	var myScroll,
		pullDownEl, pullDownOffset,
		pullUpEl, pullUpOffset,
		generatedCount = 0;
	
	/**
	 * 下拉刷新 （自定义实现此方法）
	 * myScroll.refresh();		// 数据加载完成后，调用界面更新方法
	 */
	function pullDownAction () {
		setTimeout(function () {	// <-- Simulate network congestion, remove setTimeout from production!
			//var i;
			//for (i=0; i<6; i++) {
			//	var html='<div class="index_item"><a href="javascript:void(0)"><img src="images/indexc_02.jpg"><div><span>who believe in simplicitywho believe .</span>ENDS IN 2 DAYS</div></a></div>';
			//	$(".index_content").append(html);
			//}
			myScroll.refresh();		//数据加载完成后，调用界面更新方法   Remember to refresh when contents are loaded (ie: on ajax completion)
		}, 1000);	// <-- Simulate network congestion, remove setTimeout from production!
	}
	
	/**
	 * 滚动翻页 （自定义实现此方法）
	 * myScroll.refresh();		// 数据加载完成后，调用界面更新方法
	 */
	function pullUpAction () {
		setTimeout(function () {	// <-- Simulate network congestion, remove setTimeout from production!
			
			var page= parseInt($('#page').val())+1;
			var url = "index.php?_c=api&_a=newevents&count=2&page=" + page;
			$.getJSON(url, function(data) {			
				for (i=0; i<data.count; i++) {
					var html='<div class="list_item"><a href="javascript:void(0)"><img src="'+data.events[i]["pic_link"]+'"><p><em>-25%</em></p><span>only 10 left</span></a><div><a href="javascript:void(0)" class="like"></a>$ 52<span>Rebate:<br><em>$ 1.5</em></span></div></div>';
					$("#listcontent").append(html);
				}
				 applyLayout();
				myScroll.refresh();
			});
			
			$('#page').val(page);
			
			//if (handler.wookmarkInstance) {
            //	handler.wookmarkInstance.clear();
          	//}
		 // handler = $('#listcontent .list_item');
         // handler.wookmark({
          // Prepare layout options.
          //autoResize: true, // This will auto-update the layout when the browser window is resized.
         // container: $('#listcontent'), // Optional, used for some extra CSS styling
         // offset: 5, // Optional, the distance between grid items
          //outerOffset: 10, // Optional, the distance to the containers border
         // itemWidth: swidth // Optional, the width of a grid item
     // });
			 applyLayout();
			myScroll.refresh();		// 数据加载完成后，调用界面更新方法 Remember to refresh when contents are loaded (ie: on ajax completion)
		}, 1000);	// <-- Simulate network congestion, remove setTimeout from production!
	}
	/**
	 * 初始化iScroll控件
	 */
	function loaded() {
		pullDownEl = document.getElementById('pullDown');
		pullDownOffset = pullDownEl.offsetHeight;
		pullUpEl = document.getElementById('pullUp');	
		pullUpOffset = pullUpEl.offsetHeight;
		
		myScroll = new iScroll('wrapper', {
			scrollbarClass: 'myScrollbar', /* 重要样式 */
			useTransition: false, /* 此属性不知用意，本人从true改为false */
			topOffset: pullDownOffset,
			onRefresh: function () {
				if (pullDownEl.className.match('loading')) {
					pullDownEl.className = '';
					pullDownEl.querySelector('.pullDownLabel').innerHTML = '下拉刷新...';
				} else if (pullUpEl.className.match('loading')) {
					pullUpEl.className = '';
					pullUpEl.querySelector('.pullUpLabel').innerHTML = '上拉加载更多...';
				}
			},
			onScrollMove: function () {
				if (this.y > 5 && !pullDownEl.className.match('flip')) {
					pullDownEl.className = 'flip';
					pullDownEl.querySelector('.pullDownLabel').innerHTML = '松手开始更新...';
					this.minScrollY = 0;
				} else if (this.y < 5 && pullDownEl.className.match('flip')) {
					pullDownEl.className = '';
					pullDownEl.querySelector('.pullDownLabel').innerHTML = '下拉刷新...';
					this.minScrollY = -pullDownOffset;
				} else if (this.y < (this.maxScrollY - 5) && !pullUpEl.className.match('flip')) {
					pullUpEl.className = 'flip';
					pullUpEl.querySelector('.pullUpLabel').innerHTML = '松手开始更新...';
					this.maxScrollY = this.maxScrollY;
				} else if (this.y > (this.maxScrollY + 5) && pullUpEl.className.match('flip')) {
					pullUpEl.className = '';
					pullUpEl.querySelector('.pullUpLabel').innerHTML = '上拉加载更多...';
					this.maxScrollY = pullUpOffset;
				}
			},
			onScrollEnd: function () {
				if (pullDownEl.className.match('flip')) {
					pullDownEl.className = 'loading';
					pullDownEl.querySelector('.pullDownLabel').innerHTML = '加载中...';				
					pullDownAction();	// Execute custom function (ajax call?)
				} else if (pullUpEl.className.match('flip')) {
					pullUpEl.className = 'loading';
					pullUpEl.querySelector('.pullUpLabel').innerHTML = '加载中...';				
					pullUpAction();	// Execute custom function (ajax call?)
				}
			}
		});
		
		setTimeout(function () { document.getElementById('wrapper').style.left = '0'; }, 800);
	}
	//初始化绑定iScroll控件 
	document.addEventListener('touchmove', function (e) { e.preventDefault(); }, false);
	document.addEventListener('DOMContentLoaded', loaded, false); 

	</script>   
</body>
</html>
